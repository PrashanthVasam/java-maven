name: Push to ECR

on:
  push:
    branches:
           - main

jobs:
  push-to-ecr:
    runs-on: ubuntu-latest

    steps:
 
      - name: Download secure file
        run: echo "${{ secrets.SECRET_NAME }}" > server.xml
      - name: Checkout code
        uses: actions/checkout@v2
      - name: Setup Java JDK
        uses: actions/setup-java@v1.4.4
        with:
          java-version: 11
      
      - name: Build with Maven
        run: mvn clean verify sonar:sonar -Dsonar.projectKey=PrashanthVasam_java-maven -Dsonar.organization=prashanthvasam -Dsonar.host.url=https://sonarcloud.io -Dsonar.login=fba6ddf742019d42da60e2bb97a8f39e21e84ace
      - name: Maven Build
        run: mvn clean package
      - name: Checkout code
        uses: actions/checkout@v2
        with:
          fetch-depth: 0
          token: ${{ secrets.PAT }}
      - name: Execute script
        run: bash my-script.sh
